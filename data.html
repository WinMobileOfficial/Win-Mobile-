<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM Agency - Admin Panel</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding-bottom: 50px; text-align: center; }
        .header { background: #ff6b6b; color: white; padding: 20px; font-size: 22px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stats { background: white; margin: 15px auto; padding: 15px; width: 90%; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .loading-text { color: #888; font-style: italic; margin: 20px; }
        table { width: 95%; margin: 10px auto; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        th, td { border: 1px solid #eee; padding: 12px; font-size: 14px; text-align: left; }
        th { background: #333; color: white; text-transform: uppercase; }
        .btn-status { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; color: white; margin: 2px; }
        .btn-approve { background: #27ae60; }
        .btn-reject { background: #e74c3c; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .tid-text { color: #666; font-size: 11px; }
    </style>
</head>
<body>

<div class="header">GM Agency Admin Control</div>

<div class="stats">
    <strong>Total Participants: </strong> <span id="count">0</span>
</div>

<div id="loading" class="loading-text">Fetching latest data from Google Sheets...</div>

<table>
    <thead>
        <tr>
            <th>Participant Name</th>
            <th>Contact & TID</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="participantTable"></tbody>
</table>

<script>
    // Aapka Google Script URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwBPqWCldY2mLqY8SA62KJGM77POOibQcHPWfTGaiwrKbahwD2C8cmdP7Lf8_RQ7u3MDg/exec";

    async function fetchFromSheet() {
        try {
            let response = await fetch(SCRIPT_URL);
            let data = await response.json();
            let table = document.getElementById("participantTable");
            let countSpan = document.getElementById("count");
            
            document.getElementById("loading").style.display = "none";
            table.innerHTML = "";
            
            // Row 2 se data lena (headings chor kar) aur ulta dikhana (Newest first)
            let participants = data.slice(1).reverse();
            countSpan.innerText = participants.length;

            participants.forEach((row) => {
                if(row[0]) { 
                    table.innerHTML += `<tr>
                        <td><strong>${row[0]}</strong></td>
                        <td>${row[1]} <br> <span class="tid-text">TID: ${row[2]}</span></td>
                        <td>
                            <button class="btn-status btn-approve">Approve</button>
                            <button class="btn-status btn-reject">Reject</button>
                        </td>
                    </tr>`;
                }
            });
        } catch (error) {
            console.error("Error fetching data:", error);
            document.getElementById("loading").innerText = "Failed to load data. Please refresh.";
        }
    }

    // Pehli baar load karne ke liye
    window.onload = fetchFromSheet;

    // Har 10 second baad auto-refresh karne ke liye
    setInterval(fetchFromSheet, 10000);
</script>

</body>
</html>
